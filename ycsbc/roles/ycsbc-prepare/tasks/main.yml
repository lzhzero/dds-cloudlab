---

- name: create benchmark directory if not exist
  command: mkdir -p {{benchmark_dir}}

- name: create benchmark directory if not exist
  raw: rm {{benchmark_dir}}/{{server_ips_filename}}; touch {{benchmark_dir}}/{{server_ips_filename}}

- name: generate server ips
  raw: "echo {{item}} >> {{benchmark_dir}}/{{server_ips_filename}}"
  with_items: "{{servers}}"

- name: copy workload files
  copy:
    src: "{{ycsb_src_dir}}/{{item}}"
    dest: "{{benchmark_dir}}"
    mode: 0644
#  with_items: "{{workloads_path}}"
  with_items: "{{workload_files}}"

- name: copy ycsbc program
  copy:
    src: "{{ycsb_src_dir}}/ycsbc"
    dest: "{{benchmark_dir}}"
    mode: 0755

- name: install related libs
  copy:
    src: "{{item}}"
    dest: /usr/local/lib
  with_fileglob:
    - "{{libs_dir}}/*"
  become: true

- name: sudo ldconfig
  shell: sudo ldconfig


- name: apt install libpq5
  apt:
    name: libpq5
    update_cache: yes
  become: true
